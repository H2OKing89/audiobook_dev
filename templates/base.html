<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Audiobook Request System{% endblock %}</title>
  {% include 'security_headers.html' %}
  <!-- OG & Twitter Meta & Favicon -->
  {# Dynamic OG & Twitter Meta for sharing; fall back to defaults #}
  <meta property="og:type" content="{{ og_type or 'website' }}">
  <meta property="og:url" content="{{ og_url or request.url }}">
  <meta property="og:title" content="{{ og_title or 'Audiobook Request System' }}">
  <meta property="og:description" content="{{ og_description or "Request audiobooks, track approvals, and join Quentin's cyberpunk library. No dad jokes required (but encouraged)." }}">
  <meta property="og:image" content="{{ og_image or 'https://picsur.kingpaging.com/i/f1eb91c4-1fc4-40a3-a258-e41448b1f3d9.png' }}">
  <meta property="og:image:alt" content="{{ og_image_alt or 'Cartoon Quentin with tech and anime vibes, holding an audiobook.' }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="{{ og_url or request.url }}">
  <meta name="twitter:title" content="{{ og_title or 'Audiobook Request System' }}">
  <meta name="twitter:description" content="{{ og_description or "Request audiobooks, track approvals, and join Quentin's cyberpunk library. No dad jokes required (but encouraged)." }}">
  <meta name="twitter:image" content="{{ og_image or 'https://picsur.kingpaging.com/i/f1eb91c4-1fc4-40a3-a258-e41448b1f3d9.png' }}">
  <link rel="icon" href="{{ og_image or 'https://picsur.kingpaging.com/i/f1eb91c4-1fc4-40a3-a258-e41448b1f3d9.png' }}">
  
  <!-- Self-hosted fonts for CSP compliance -->
  <link rel="stylesheet" href="/static/css/fonts.css">
  
  <!-- New CSS Architecture -->
  <link rel="stylesheet" href="/static/css/base.css">
  <link rel="stylesheet" href="/static/css/components.css">
  <link rel="stylesheet" href="/static/css/alpine-enhancements.css">
  
  {% block head_extra %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
  {% block content %}{% endblock %}
  
  <!-- Alpine.js - Conditionally load from CDN or self-hosted based on config -->
  {% set config = get_config() %}
  {% if config.get('frontend', {}).get('use_external_js', true) %}
  <script defer src="https://unpkg.com/alpinejs@3.15.2/dist/cdn.min.js"></script>
  {% else %}
  <script defer src="/static/js/alpine.min.js"></script>
  {% endif %}
  
  <!-- Alpine.js Components (load after Alpine) -->
  <script defer src="/static/js/alpine-components.js"></script>
  
  <!-- Legacy JavaScript (keep for backward compatibility during migration) -->
  <script defer src="/static/js/base.js"></script>
  <script defer src="/static/js/components.js"></script>
  
  {% block scripts %}{% endblock %}
</body>
</html>
