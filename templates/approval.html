{% extends "base.html" %}

{% block body_class %}approval-page{% endblock %}

{% block title %}üéß Approval Zone - {{ title or name or 'Mystery Audiobook' }}{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="/static/css/pages/approval.css">
<script src="/static/js/pages/approval.js" defer></script>
{% endblock %}

{% block content %}
<div class="approval-zone">
  <div class="glitch-container">

    <!-- Fun Header -->
    <header class="zone-header">
      <div class="terminal-window">
        <div class="terminal-bar">
          <span class="terminal-dot red"></span>
          <span class="terminal-dot yellow"></span>
          <span class="terminal-dot green"></span>
        </div>
        <div class="terminal-content">
          <div class="typing-text">
            <span class="prompt">quentin@audiobook-hq:~$</span>
            <span class="command">ÂÆ°ÊâπÊ®°ÂºèÂ∑≤ÊøÄÊ¥ª // APPROVAL MODE ACTIVATED</span>
          </div>
        </div>
      </div>
      <div class="status-bar">
        <span class="status-item">STATUS: <span class="status-pending">PENDING REVIEW</span></span>
        <span class="status-item">PRIORITY: <span class="status-high">HIGH</span></span>
        <span class="status-item">TOKEN: <span class="status-token">{{ token }}</span></span>
      </div>
    </header>

    <!-- Main Content Viewport -->
    <main class="content-viewport">
      <div class="book-scanner">
        <div class="scanner-line"></div>

        <!-- Book Info Panel -->
        <section class="book-panel">
          <div class="panel-header">
            <h2 class="panel-title">üìÅ INCOMING TRANSMISSION</h2>
            <div class="signal-strength">
              <span class="signal-bar"></span>
              <span class="signal-bar"></span>
              <span class="signal-bar"></span>
              <span class="signal-bar"></span>
            </div>
          </div>

          <div class="book-layout">
            <!-- Compact Cover -->
            {% if cover_url or image %}
            <div class="cover-mini">
              <div class="cover-frame-mini">
                <img src="{{ cover_url or image }}"
                     alt="Cover: {{ title or name or 'Unknown Title' }}"
                     class="cover-img"
                     onerror="this.parentElement.innerHTML='<div class=&quot;cover-fallback&quot;>ÔøΩ</div>'">
                <div class="cover-scan-effect"></div>
              </div>
            </div>
            {% endif %}

            <!-- Book Data -->
            <div class="book-data">
              <h3 class="book-title">{{ title or name or '[ TITLE_NOT_FOUND ]' }}</h3>
              <div class="book-meta">
                <div class="meta-row">
                  <span class="meta-label">AUTHOR:</span>
                  <span class="meta-value">{{ author or 'UNKNOWN_ENTITY' }}</span>
                </div>
                {% if narrator %}
                <div class="meta-row">
                  <span class="meta-label">NARRATOR:</span>
                  <span class="meta-value">{{ narrator }}</span>
                </div>
                {% endif %}
                {% if series %}
                <div class="meta-row">
                  <span class="meta-label">SERIES:</span>
                  <span class="meta-value">{{ series }}</span>
                </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Description -->
          {% if description %}
          <div class="description-panel">
            <div class="panel-subheader">üìù SYNOPSIS.TXT</div>
            <div class="description-content" style="white-space: pre-wrap;">{{ description }}</div>
          </div>
          {% endif %}

          <!-- Tech Specs -->
          <div class="specs-grid">
            {% if duration %}
            <div class="spec-card">
              <div class="spec-icon">‚è±Ô∏è</div>
              <div class="spec-data">
                <div class="spec-label">DURATION</div>
                <div class="spec-value">{{ duration }}</div>
              </div>
            </div>
            {% endif %}

            {% if release_date %}
            <div class="spec-card">
              <div class="spec-icon">üìÖ</div>
              <div class="spec-data">
                <div class="spec-label">RELEASED</div>
                <div class="spec-value">{{ release_date }}</div>
              </div>
            </div>
            {% endif %}

            {% if genre %}
            <div class="spec-card">
              <div class="spec-icon">ÔøΩ</div>
              <div class="spec-data">
                <div class="spec-label">GENRE</div>
                <div class="spec-value">{{ genre }}</div>
              </div>
            </div>
            {% endif %}

            {% if publisher %}
            <div class="spec-card">
              <div class="spec-icon">ÔøΩ</div>
              <div class="spec-data">
                <div class="spec-label">PUBLISHER</div>
                <div class="spec-value">{{ publisher }}</div>
              </div>
            </div>
            {% endif %}

            {% if size %}
            <div class="spec-card">
              <div class="spec-icon">üíæ</div>
              <div class="spec-data">
                <div class="spec-label">FILE_SIZE</div>
                <div class="spec-value">{{ size }}</div>
              </div>
            </div>
            {% endif %}

            {% if url %}
            <div class="spec-card spec-wide">
              <div class="spec-icon">üîó</div>
              <div class="spec-data">
                <div class="spec-label">SOURCE_LINK</div>
                <div class="spec-value">
                  <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="source-link">
                    üåê VIEW_ORIGINAL.EXE
                  </a>
                </div>
              </div>
            </div>
            {% endif %}
          </div>
        </section>

        <!-- Action Console -->
        <section class="action-console">
          <div class="console-header">
            <h3>‚ö° DECISION MATRIX</h3>
            <div class="warning-text">‚ö†Ô∏è IRREVERSIBLE_OPERATION ‚ö†Ô∏è</div>
          </div>

          <div class="button-array">
            <form method="post" action="/approve/{{ token }}" class="approve-form" style="display:inline-block;">
              {% include 'csrf_input.html' %}
              <button type="submit" class="matrix-btn approve-matrix btn btn-approve" role="button" aria-label="Approve request">
                <div class="btn-glow"></div>
                <div class="btn-content">
                  <span class="btn-icon">‚úÖ</span>
                  <span class="btn-text">APPROVE.EXE</span>
                  <span class="btn-hotkey">[A]</span>
                </div>
                <div class="btn-shimmer"></div>
              </button>
            </form>

            <form method="post" action="/reject/{{ token }}" class="reject-form" style="display:inline-block; margin-left: 12px;">
              {% include 'csrf_input.html' %}
              <button type="submit" class="matrix-btn reject-matrix btn btn-reject" role="button" aria-label="Reject request">
                <div class="btn-glow"></div>
                <div class="btn-content">
                  <span class="btn-icon">‚ùå</span>
                  <span class="btn-text">REJECT.EXE</span>
                  <span class="btn-hotkey">[R]</span>
                </div>
                <div class="btn-shimmer"></div>
              </button>
            </form>
          </div>

          <div class="footer-note">
            <span class="note-icon">üîí</span>
            Action logged to blockchain. No takebacks, chief.
          </div>
        </section>
      </div>
    </main>

    <!-- System Footer -->
    <footer class="system-footer">
      <div class="footer-stats">
        <span>UPTIME: 99.9%</span>
        <span>CPU: 12%</span>
        <span>MEMORY: 420MB</span>
        <span>DAD_JOKES: ‚àû</span>
      </div>
    </footer>
  </div>
</div>
{% endblock %}
